@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Manrope:wght@300;500;600;800&display=swap');

:root {
  color-scheme: dark;
  /* Organic Palette */
  --forest-dark: #0a2a0a;
  --forest-black: #000000;
  --sun-yellow: #fbc02d;
  --petal-yellow: #fff176;
  --cream: #f5f5dc;
  --soil-brown: #3e2723;
  --leaf-accent: #79c267;
}

*,
*::before,
*::after {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

/* === STARRY NIGHT BACKGROUND === */
body {
  margin: 0;
  min-height: 100vh;
  font-family: 'Manrope', system-ui, sans-serif;
  color: var(--cream);
  overflow-x: hidden;
  background: url('fotos/bosque_oscuro.png') center/cover fixed no-repeat;
  position: relative;
  transition: filter 2s ease;
}

html {
  -webkit-text-size-adjust: 100%;
  text-size-adjust: 100%;
}

body.final-sequence-lighting {
  filter: brightness(0.6) saturate(1);
}

body.final-sequence-lighting.final-bloomed {
  filter: brightness(1.2) saturate(1.35) hue-rotate(-6deg);
}

/* Komorebi + viñeta romántica */
body::before {
  content: "";
  position: fixed;
  inset: 0;
  pointer-events: none;
  background:
    radial-gradient(circle at 50% 45%, rgba(255, 255, 210, 0.25) 0%, rgba(255, 215, 150, 0.18) 25%, rgba(10, 42, 10, 0.0) 55%),
    linear-gradient(135deg, rgba(255, 240, 200, 0.18) 0%, rgba(0, 0, 0, 0) 40%, rgba(10, 42, 10, 0.35) 100%);
  mix-blend-mode: screen;
  z-index: 0;
}

body::after {
  content: "";
  position: fixed;
  inset: 0;
  pointer-events: none;
  background: radial-gradient(circle at 50% 50%, rgba(0, 0, 0, 0) 55%, rgba(6, 20, 6, 0.65) 100%);
  z-index: 0;
}

/* Enhanced Twinkling Stars Overlay */
body::after {
  content: "";
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;

  /* Create varied star field using box-shadow for different sizes */
  background: transparent;
  box-shadow:
    /* Large bright stars */
    12% 18% 0 2px rgba(255, 255, 255, 0.9),
    67% 24% 0 2px rgba(255, 255, 255, 0.85),
    89% 55% 0 1.5px white,
    23% 72% 0 2px rgba(255, 255, 200, 0.9),
    /* Medium stars */
    45% 12% 0 1px rgba(255, 255, 255, 0.8),
    78% 67% 0 1px white,
    34% 89% 0 1px rgba(200, 255, 200, 0.7),
    91% 33% 0 1px rgba(255, 255, 255, 0.75),
    56% 78% 0 1px white,
    /* Small stars */
    8% 45% 0 0.5px rgba(255, 255, 255, 0.7),
    28% 34% 0 0.5px white,
    52% 91% 0 0.5px rgba(255, 255, 255, 0.6),
    73% 8% 0 0.5px white,
    95% 82% 0 0.5px rgba(255, 255, 255, 0.8),
    15% 62% 0 0.5px white,
    64% 43% 0 0.5px rgba(255, 255, 200, 0.7),
    87% 15% 0 0.5px white,
    41% 58% 0 0.5px rgba(255, 255, 255, 0.65),
    6% 27% 0 0.5px white;

  width: 1px;
  height: 1px;
  border-radius: 50%;

  /* Gentle twinkling animation */
  animation: starTwinkle 6s ease-in-out infinite;
}

@keyframes starTwinkle {

  0%,
  100% {
    opacity: 0.7;
    transform: scale(1);
  }

  25% {
    opacity: 0.85;
    transform: scale(1.1);
  }

  50% {
    opacity: 1;
    transform: scale(1.2);
  }

  75% {
    opacity: 0.85;
    transform: scale(1.1);
  }
}

.page {
  position: relative;
  z-index: 1;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 2rem 1rem;
  gap: 3rem;
}

/* === GLASSMORPHISM ORGÁNICO === */
.glass-panel {
  background: rgba(245, 30, 10, 0.08);
  border: 1px solid rgba(255, 255, 255, 0.08);
  backdrop-filter: blur(15px);
  -webkit-backdrop-filter: blur(15px);
  box-shadow: 0 12px 40px rgba(0, 0, 0, 0.45);
  border-radius: 24px;
  padding: 3rem;
  width: min(100%, 1100px);
}

/* === HERO SECTION === */
.hero {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: 90vh;
  width: 100%;
  /* NO background, NO container boxes */
}

.hero-grid {
  width: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 2;
  padding: 1rem;
}

/* === SUNFLOWER CONTAINER === */
#sunflower-container {
  position: relative;
  width: min(600px, 94vw);
  height: min(600px, 94vw);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10;
}

.sunflower-center {
  position: absolute;
  top: 50%;
  left: 50%;
  width: clamp(118px, 31vw, 200px);
  height: clamp(118px, 31vw, 200px);
  transform: translate(-50%, -50%);
  border-radius: 50%;
  clip-path: circle(48.5%);
  overflow: hidden;
  cursor: pointer;
  background: url('fotos/centro_girasol.png') center/cover no-repeat;
  z-index: 100;
  object-fit: cover;
  filter: drop-shadow(0 0 30px rgba(255, 215, 0, 0.4));
  animation: breatheGlow 6s ease-in-out infinite;
  border: 2px solid rgba(255, 215, 0, 0.3);
  box-shadow: inset 0 0 15px rgba(0, 0, 0, 0.5);
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

/* Pétalos Base */
.petal {
  position: absolute;
  bottom: 50%;
  left: 50%;
  width: clamp(62px, 15vw, 90px);
  height: clamp(108px, 25vw, 150px);
  transform-origin: bottom center;
  transform: translate(-50%, 0) rotate(var(--angle)) scale(0);
  opacity: 0;
  transition: transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.6s ease;
  pointer-events: none;
  -webkit-tap-highlight-color: transparent;
}

.petal-front {
  z-index: 6;
}

.petal-back {
  z-index: 2;
  pointer-events: none;
}

/* Estado Florecer (Usando el ID correcto) */
#sunflower-container.florecer .petal {
  opacity: 1;
  pointer-events: auto;
  transform: translate(-50%, 0) rotate(var(--angle)) scale(1);
}

#sunflower-container.florecer .petal.petal-empty {
  pointer-events: none;
}

#sunflower-container.florecer .petal-back {
  pointer-events: none;
  filter: brightness(0.75);
}

/* Etiquetas de Texto */
.petal-label {
  position: absolute;
  top: 8px;
  left: 50%;
  /* Contra-rotación para legibilidad */
  transform: translateX(-50%) rotate(calc(var(--angle) * -1));
  color: var(--cream);
  font-family: 'Playfair Display', serif;
  font-size: 0.84rem;
  font-weight: 700;
  text-shadow: 0 2px 7px rgba(0, 0, 0, 0.72);
  white-space: nowrap;
  padding: 0.16rem 0.45rem;
  border-radius: 999px;
  background: rgba(12, 12, 12, 0.42);
  border: 1px solid rgba(255, 242, 214, 0.36);
  box-shadow: 0 8px 16px rgba(0, 0, 0, 0.22);
  z-index: 3;
  pointer-events: none;
}

.petal-front.petal-active .petal-label {
  opacity: 1;
}

/* Animación de Viento */
@keyframes gentleWind {

  0%,
  100% {
    transform: translate(-50%, 0) rotate(var(--angle)) skew(0deg);
  }

  50% {
    transform: translate(-50%, 0) rotate(calc(var(--angle) + 2deg)) skew(1deg);
  }
}

#sunflower-container.florecer .petal {
  animation: gentleWind 4s ease-in-out infinite;
  animation-delay: var(--wind-delay);
}

@keyframes breatheGlow {

  0%,
  100% {
    filter: drop-shadow(0 0 24px rgba(255, 215, 0, 0.35));
  }

  50% {
    filter: drop-shadow(0 0 34px rgba(255, 215, 0, 0.55));
  }
}

/* === CONTENT PANELS === */
.panel {
  display: flex;
  flex-direction: column;
  gap: 2rem;
}

#memories {
  position: relative;
  overflow: hidden;
}

/* === Raíces / Corte transversal === */
#roots-panel .panel-header {
  gap: 0.6rem;
}

.roots-stage {
  display: grid;
  grid-template-columns: minmax(320px, 1fr) minmax(280px, 0.9fr);
  gap: clamp(1.8rem, 3vw, 3rem);
  align-items: center;
}

@media (max-width: 900px) {
  .roots-stage {
    grid-template-columns: 1fr;
  }
}

.trunk-wrap {
  position: relative;
  width: min(480px, 90vw);
  aspect-ratio: 1 / 1;
  margin: 0 auto;
  display: grid;
  place-items: center;
  filter: drop-shadow(0 20px 40px rgba(0, 0, 0, 0.45));
}

#treeTrunk {
  width: 100%;
  height: 100%;
  transition: transform 0.18s ease-out;
}

.ring-node {
  fill: #ffd95b;
  stroke: #8b5a2b;
  stroke-width: 2.5;
  filter: drop-shadow(0 0 10px rgba(255, 217, 91, 0.7));
  cursor: pointer;
  transition: transform 0.2s ease, opacity 0.2s ease;
  opacity: 0.65;
}

.ring-node.active {
  opacity: 1;
  transform: scale(1.25);
}

.roots-journal {
  background: rgba(255, 255, 255, 0.06);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 18px;
  padding: 1.6rem;
  box-shadow: 0 16px 40px rgba(0, 0, 0, 0.3);
  display: grid;
  gap: 0.9rem;
}

.journal-pre {
  text-transform: uppercase;
  letter-spacing: 0.28em;
  font-size: 0.75rem;
  opacity: 0.7;
}

.roots-journal h3 {
  font-family: 'Playfair Display', serif;
  color: #f6e2c4;
}

.roots-journal p {
  color: rgba(245, 245, 220, 0.9);
  line-height: 1.6;
}

.journal-photo {
  margin: 0;
  display: grid;
  gap: 0.5rem;
  align-content: start;
}

.journal-photo img {
  width: 100%;
  border-radius: 12px;
  object-fit: cover;
  max-height: 340px;
  box-shadow: 0 14px 36px rgba(0, 0, 0, 0.35);
}

.journal-photo figcaption {
  font-family: 'Playfair Display', serif;
  color: #fdf6e3;
  opacity: 0.9;
}

.orbit-daisies {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

.orbit-daisy {
  position: absolute;
  width: 32px;
  height: 32px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: radial-gradient(circle at 40% 40%, #ffffff 0%, #fff9e6 65%, #fbc02d 100%);
  border-radius: 50%;
  box-shadow: 0 0 12px rgba(255, 255, 255, 0.35);
  animation: orbit 12s linear infinite;
  animation-delay: var(--delay, 0s);
}

.orbit-daisy::before,
.orbit-daisy::after {
  content: "";
  position: absolute;
  inset: -12px;
  border: 2px solid rgba(255, 255, 255, 0.12);
  border-radius: 50%;
}

.orbit-daisy::after {
  inset: -18px;
  border-color: rgba(255, 255, 255, 0.06);
}

@keyframes orbit {
  from {
    transform: translate(-50%, -50%) rotate(0deg) translateX(var(--orbit, 140px)) rotate(0deg);
  }

  to {
    transform: translate(-50%, -50%) rotate(360deg) translateX(var(--orbit, 140px)) rotate(-360deg);
  }
}

.panel-header h2 {
  font-family: 'Playfair Display', serif;
  font-size: clamp(1.8rem, 4.4vw, 2.5rem);
  color: #f6e2c4;
  margin-bottom: 0.75rem;
  text-shadow: 0 6px 18px rgba(0, 0, 0, 0.45);
}

.panel-header p {
  color: rgba(245, 245, 220, 0.9);
}

.panel-header p {
  color: rgba(245, 245, 220, 0.9);
  font-size: 1.1rem;
  line-height: 1.7;
  max-width: 700px;
}

/* Memory/Photosynthesis Section */
.memory-stage {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 3rem;
  align-items: start;
}

/* === Forest Exploration Gallery === */
.soft-hidden {
  display: none;
}

.intro-forest {
  position: absolute;
  inset: 0;
  z-index: 3;
  display: grid;
  place-items: center;
  padding: clamp(1.8rem, 4vw, 3rem);
  background: radial-gradient(circle at 50% 40%, rgba(5, 18, 8, 0.9), rgba(0, 0, 0, 0.94));
  backdrop-filter: blur(8px);
}

.intro-inner {
  max-width: 720px;
  text-align: center;
  color: #f6e2c4;
  display: grid;
  gap: 0.9rem;
}

.intro-pre {
  letter-spacing: 0.28em;
  text-transform: uppercase;
  font-size: 0.8rem;
  opacity: 0.75;
}

.intro-title {
  font-family: 'Playfair Display', serif;
  font-size: clamp(1.6rem, 2.4vw, 2.2rem);
  line-height: 1.5;
  color: #fdf6e3;
  text-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
}

.intro-btn {
  justify-self: center;
  margin-top: 0.4rem;
  padding: 0.85rem 2.4rem;
  border-radius: 999px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  background: linear-gradient(135deg, #1e3a28, #102017);
  color: #fdf6e3;
  font-weight: 700;
  letter-spacing: 0.08em;
  cursor: pointer;
  transition: transform 0.25s ease, box-shadow 0.25s ease;
}

.intro-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.4);
}

.intro-forest.fade-out {
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.8s ease;
}

.forest-layout {
  display: grid;
  grid-template-columns: minmax(340px, 1.2fr) minmax(260px, 0.8fr);
  gap: clamp(1.6rem, 2vw, 3rem);
  align-items: stretch;
}

@media (max-width: 900px) {
  .forest-layout {
    grid-template-columns: 1fr;
  }
}

.forest-panel {
  position: relative;
  min-height: 520px;
  border-radius: 26px;
  overflow: hidden;
  background:
    linear-gradient(145deg, rgba(12, 35, 12, 0.62), rgba(6, 16, 8, 0.72)),
    url('fotos/bosque_oscuro.png');
  background-size: cover;
  background-position: var(--bg-x, 50%) var(--bg-y, 50%);
  filter: saturate(0.55) brightness(0.64);
  border: 1px solid rgba(255, 255, 255, 0.08);
  box-shadow: 0 24px 50px rgba(0, 0, 0, 0.55);
  isolation: isolate;
}

.forest-panel::after {
  content: "";
  position: absolute;
  inset: 0;
  background:
    linear-gradient(165deg, rgba(8, 13, 9, 0.82), rgba(3, 6, 4, 0.92)),
    url('fotos/bosque_oscuro.png') center/cover no-repeat;
  filter: saturate(0.38) brightness(0.36);
  pointer-events: none;
  mask-image: radial-gradient(240px at var(--light-x, 50%) var(--light-y, 50%),
      transparent 0 55%,
      rgba(0, 0, 0, 0.34) 65%,
      rgba(0, 0, 0, 0.7) 75%,
      black 90%);
  -webkit-mask-image: radial-gradient(240px at var(--light-x, 50%) var(--light-y, 50%),
      transparent 0 55%,
      rgba(0, 0, 0, 0.34) 65%,
      rgba(0, 0, 0, 0.7) 75%,
      black 90%);
  transition: mask-image 0.12s linear, -webkit-mask-image 0.12s linear;
}

.forest-meadow {
  position: absolute;
  inset: 0;
}

.daisy {
  position: absolute;
  width: 120px;
  height: 120px;
  translate: -50% -50%;
  background: none;
  border: none;
  padding: 0;
  cursor: pointer;
  transform: translate(-50%, -50%) scale(0.5);
  transition: transform 0.18s ease, filter 0.2s ease;
  will-change: transform, filter;
  mix-blend-mode: screen;
}

.daisy svg {
  width: 100%;
  height: 100%;
  filter: drop-shadow(0 8px 20px rgba(0, 0, 0, 0.25));
}

.daisy .petals path {
  filter: drop-shadow(0 3px 8px rgba(0, 0, 0, 0.12));
}

.daisy .daisy-center {
  stroke: rgba(62, 39, 35, 0.8);
  stroke-width: 2;
  filter: drop-shadow(0 0 10px rgba(255, 193, 7, 0.5));
}

.forest-copy {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid rgba(255, 255, 255, 0.1);
  border-radius: 20px;
  padding: 2rem;
  box-shadow: 0 16px 40px rgba(0, 0, 0, 0.35);
}

.forest-copy h3 {
  font-family: 'Playfair Display', serif;
  margin-bottom: 0.4rem;
  color: #f6e2c4;
}

.forest-legend {
  margin-top: 0.8rem;
  display: grid;
  gap: 0.5rem;
  padding-left: 1rem;
  color: rgba(245, 245, 220, 0.9);
}

/* Lightbox Forestal */
.forest-lightbox {
  position: fixed;
  inset: 0;
  display: grid;
  place-items: center;
  background: rgba(0, 0, 0, 0.8);
  backdrop-filter: blur(6px);
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s ease;
  z-index: 999;
}

.forest-lightbox.open {
  opacity: 1;
  pointer-events: auto;
}

.lightbox-frame {
  position: relative;
  padding: 18px;
  background: linear-gradient(135deg, #2e1a0f, #4a2d1b);
  border: 6px solid #c29a6b;
  box-shadow: 0 24px 80px rgba(0, 0, 0, 0.6);
  border-radius: 18px;
  max-width: min(880px, 86vw);
}

.lightbox-photo {
  display: block;
  max-width: 100%;
  max-height: 78vh;
  border-radius: 12px;
  object-fit: contain;
  background: #0f0f0f;
}

.lightbox-figure {
  margin: 0;
  display: grid;
  gap: 0.6rem;
  padding: 12px;
  background: radial-gradient(circle at 30% 30%, #fff8e6, #f1e1c2 65%, #e0c9a0 100%);
  border-radius: 14px;
  box-shadow: inset 0 0 0 1px rgba(255, 255, 255, 0.5), inset 0 0 30px rgba(0, 0, 0, 0.15);
}

.lightbox-caption {
  text-align: center;
  color: #fdf6e3;
  font-family: 'Playfair Display', serif;
  font-size: 1.05rem;
  font-weight: 700;
  letter-spacing: 0.04em;
  padding: 10px 16px;
  border-radius: 12px;
  background: rgba(0, 0, 0, 0.38);
  text-shadow: 0 2px 6px rgba(0, 0, 0, 0.55);
  backdrop-filter: blur(2px);
}

/* === Semillas: Campo de Margaritas === */
.seeds-shell {
  position: relative;
  overflow: hidden;
}

.seeds-stage {
  position: relative;
  min-height: 520px;
}

.seeds-field {
  position: relative;
  border-radius: 26px;
  overflow: hidden;
  min-height: 520px;
  background: linear-gradient(135deg, rgba(255, 215, 165, 0.35), rgba(20, 35, 25, 0.75)), url('fotos/campo_margaritas.png');
  background-size: cover;
  background-position: center;
  box-shadow: 0 24px 50px rgba(0, 0, 0, 0.55);
}

.seeds-blur {
  position: absolute;
  inset: 0;
  backdrop-filter: blur(2px);
  background: linear-gradient(180deg, rgba(0, 0, 0, 0.18), rgba(0, 0, 0, 0.45));
}

.seeds-flowers {
  position: absolute;
  inset: 0;
  pointer-events: none;
}

.seed-daisy {
  position: absolute;
  pointer-events: auto;
  background: none;
  border: none;
  padding: 0;
  width: 110px;
  height: 110px;
  transform: translate(-50%, -50%) scale(0.7);
  transition: transform 0.18s ease, filter 0.18s ease;
  cursor: pointer;
}

.seed-daisy svg {
  width: 100%;
  height: 100%;
  filter: drop-shadow(0 10px 22px rgba(0, 0, 0, 0.35));
}

.seed-daisy .petals path {
  filter: drop-shadow(0 2px 6px rgba(0, 0, 0, 0.12));
}

.seed-daisy:focus-visible {
  outline: 2px solid var(--sun-yellow);
  outline-offset: 4px;
}

.seeds-flowers.disabled {
  pointer-events: none;
  opacity: 0.4;
}

.seeds-field.final-dim {
  filter: brightness(0.4);
  transition: filter 0.8s ease;
}

.firefly-final {
  position: absolute;
  width: 12px;
  height: 12px;
  background: radial-gradient(circle at 30% 30%, #fff7c2 0%, #fbc02d 60%, rgba(255, 193, 7, 0) 100%);
  border-radius: 50%;
  box-shadow: 0 0 12px 6px rgba(255, 215, 80, 0.6);
  animation: fireflyFinal 2.6s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

@keyframes fireflyFinal {
  0% {
    transform: translate(-50%, -40px);
    opacity: 0;
  }

  20% {
    opacity: 1;
    transform: translate(-50%, 80px) translateX(40px);
  }

  60% {
    transform: translate(-50%, 220px) translateX(-30px);
  }

  100% {
    transform: translate(-50%, 320px);
    opacity: 1;
  }
}

/* === SAPLING GROWTH SYSTEM === */
.sapling {
  --growth: 1;
  position: absolute;
  left: 50%;
  top: 70%;
  transform: translate(-50%, -50%) scale(var(--growth));
  transform-origin: center;
  cursor: pointer;
  filter: drop-shadow(0 14px 28px rgba(0, 0, 0, 0.35));
  transition: transform 0.75s cubic-bezier(0.24, 1.25, 0.36, 1), filter 0.6s ease;
}

.sapling svg {
  width: 100%;
  height: 100%;
}

#final-sapling-container {
  width: min(340px, 78vw);
  aspect-ratio: 3 / 4;
}

#final-sapling-svg {
  width: 100%;
  height: 100%;
}

#sapling-stem path {
  stroke-dasharray: 290;
  stroke-dashoffset: 290;
  animation: stemDraw 1.15s ease-out forwards;
}

#sapling-stem {
  transform-origin: 120px 292px;
  animation: swayStem 5.8s ease-in-out infinite;
  animation-delay: 1.1s;
}

@keyframes stemDraw {
  to {
    stroke-dashoffset: 0;
  }
}

/* Pétalos - Estado inicial cerrado */
#final-sapling-container .petal {
  fill: url(#finalPetalGrad);
  stroke: rgba(216, 109, 47, 0.58);
  stroke-width: 1.3;
  transform-origin: 0px 0px;
  transform: scale(0) rotateZ(var(--initial-angle));
  opacity: 0;
  transition: transform 1.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 1s ease;
  transition-delay: var(--delay, 0s);
  filter: url(#finalPetalOrganic) drop-shadow(var(--shadow-x, 0px) var(--shadow-y, 4px) 8px rgba(62, 39, 35, 0.28));
}

/* Estado floreciendo - Los pétalos se abren */
#final-sapling-container.blooming .petal {
  transform: scale(1) rotateZ(var(--final-angle));
  opacity: var(--petal-alpha, 1);
}

/* Intensifica el centro al florecer */
#flower-head-sway {
  transform-origin: 0px 0px;
  animation: swayHead 5.8s ease-in-out infinite;
  animation-play-state: paused;
}

#final-sapling-container.blooming #flower-head-sway {
  animation-play-state: running;
}

#flower-head circle {
  transform-origin: 0px 0px;
  transition: filter 0.9s ease;
}

#final-sapling-container.blooming #flower-head circle {
  filter: drop-shadow(0 0 22px rgba(255, 223, 140, 0.8));
}

/* Luz trasera orgÃ¡nica en estado de espera */
#back-light {
  transform-origin: 120px 108px;
  animation: pulse 3s ease-in-out infinite;
  transition: transform 0.8s ease, opacity 0.8s ease, filter 0.8s ease, fill 0.8s ease;
}

/* AnimaciÃ³n de latido suave mientras espera */
@keyframes pulse {

  0%,
  100% {
    transform: scale(1);
    opacity: 0.5;
    filter: url(#organic-glow) drop-shadow(0 0 6px rgba(255, 202, 71, 0.45));
  }

  50% {
    transform: scale(1.22);
    opacity: 0.72;
    filter: url(#organic-glow) drop-shadow(0 0 18px rgba(255, 202, 71, 0.75));
  }
}

/* Estado cuando la flor ha florecido por completo */
#final-sapling-container.blooming #back-light {
  animation: none;
  transform: scale(2.6);
  opacity: 0.4;
  filter: url(#organic-glow) drop-shadow(0 0 34px rgba(255, 215, 100, 0.92));
  fill: #fff5c2;
}

@keyframes swayStem {
  0%,
  100% {
    transform: rotate(-1.6deg);
  }

  50% {
    transform: rotate(1.8deg);
  }
}

@keyframes swayHead {
  0%,
  100% {
    transform: rotate(-2.8deg) translateY(0);
  }

  50% {
    transform: rotate(3deg) translateY(-1px);
  }
}


/* === FLOATING PARTICLES === */


.heart-spark {
  position: absolute;
  width: 18px;
  height: 18px;
  background:
    radial-gradient(circle at 30% 30%, #fff5c2 0%, #ffd95b 60%, rgba(255, 193, 7, 0) 100%);
  clip-path: path("M8 2 C8 -1 13 -1 13 3 C13 6 8 10 8 10 C8 10 3 6 3 3 C3 -1 8 -1 8 2 Z");
  animation: heartRise 1.4s ease-out forwards;
  filter: drop-shadow(0 0 8px rgba(255, 215, 80, 0.6));
}

@keyframes heartRise {
  to {
    transform: translateY(-40px) scale(0.8);
    opacity: 0;
  }
}

.sapling-leaf {
  position: absolute;
  width: 12px;
  height: 18px;
  background: radial-gradient(circle at 30% 30%, #ffffff, #f0ffd9 65%, #89c779 100%);
  border-radius: 10px 10px 2px 10px;
  transform: rotate(-12deg);
  filter: drop-shadow(0 4px 10px rgba(0, 0, 0, 0.25));
  animation: leafPop 0.6s cubic-bezier(0.34, 1.56, 0.64, 1);
}

@keyframes leafPop {
  from {
    opacity: 0;
    transform: scale(0.6) rotate(-12deg);
  }

  to {
    opacity: 1;
    transform: scale(1) rotate(-12deg);
  }
}

.final-pollen {
  position: absolute;
  width: 9px;
  height: 9px;
  background: radial-gradient(circle at 30% 30%, #fff4bd 0%, #fbc02d 55%, #d84315 100%);
  border-radius: 50%;
  box-shadow: 0 0 10px 4px rgba(251, 192, 45, 0.35);
  transform: translate(-50%, -50%);
  animation: finalOrbit 2.8s cubic-bezier(0.2, 0.7, 0.24, 1) forwards;
}

@keyframes finalOrbit {
  0% {
    transform: translate(-50%, -50%) rotate(var(--spin-start, 0deg)) translateX(calc(var(--orbit, 64px) * 0.15)) scale(0.25);
    opacity: 0;
  }

  20% {
    transform: translate(-50%, -50%) rotate(calc(var(--spin-start, 0deg) + 90deg)) translateX(var(--orbit, 64px)) scale(1);
    opacity: 0.95;
  }

  70% {
    transform: translate(-50%, -50%) rotate(calc(var(--spin-start, 0deg) + var(--spin-turn, 540deg))) translateX(calc(var(--orbit, 64px) * 0.8)) translateY(calc(var(--rise, -55px) * 0.55)) scale(0.72);
    opacity: 0.8;
  }

  100% {
    transform: translate(-50%, -50%) rotate(calc(var(--spin-start, 0deg) + var(--spin-turn, 540deg))) translateX(calc(var(--orbit, 64px) * 0.3)) translateY(var(--rise, -55px)) scale(0.22);
    opacity: 0;
  }
}

.final-message {
  position: fixed;
  inset: 0;
  display: grid;
  place-items: center;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(8px);
  z-index: 1200;
  padding: 1.5rem;
  opacity: 0;
  animation: finalMessageFade 0.85s ease forwards;
}

.final-card {
  max-width: min(780px, 90vw);
  background: linear-gradient(155deg, rgba(74, 93, 35, 0.26), rgba(62, 39, 35, 0.38));
  border: 1px solid rgba(251, 192, 45, 0.24);
  border-radius: 18px;
  padding: clamp(1.6rem, 3vw, 2.8rem);
  box-shadow: 0 30px 80px rgba(0, 0, 0, 0.45);
  text-align: center;
  opacity: 0;
  transform: translateY(12px);
  animation: finalCardReveal 0.95s ease 0.1s forwards;
}

.final-pre {
  letter-spacing: 0.3em;
  text-transform: uppercase;
  font-size: 0.85rem;
  opacity: 0.7;
  margin-bottom: 0.8rem;
}

.final-card h3 {
  font-family: 'Playfair Display', serif;
  font-size: clamp(1.4rem, 2.5vw, 1.9rem);
  color: #fdf6e3;
  line-height: 1.6;
  text-shadow: 0 2px 10px rgba(0, 0, 0, 0.45);
}

@keyframes finalMessageFade {
  to {
    opacity: 1;
  }
}

@keyframes finalCardReveal {
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.love-note {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.55);
  backdrop-filter: blur(6px);
  display: grid;
  place-items: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s ease;
  z-index: 1000;
}

.love-note.open {
  opacity: 1;
  pointer-events: auto;
}

.note-card {
  position: relative;
  max-width: min(640px, 90vw);
  padding: clamp(1.4rem, 3vw, 2.4rem);
  background: #f7eddc;
  color: #3e2723;
  border-radius: 16px;
  box-shadow: 0 24px 70px rgba(0, 0, 0, 0.4), inset 0 0 0 1px rgba(255, 255, 255, 0.5);
  font-family: 'Playfair Display', serif;
  line-height: 1.6;
}

.note-card::after {
  content: '';
  position: absolute;
  inset: 10px;
  border: 1px dashed rgba(0, 0, 0, 0.08);
  pointer-events: none;
}

.note-close {
  position: absolute;
  top: 12px;
  right: 12px;
  width: 32px;
  height: 32px;
  border-radius: 50%;
  border: none;
  background: #d8c4a3;
  color: #3e2723;
  font-size: 1.2rem;
  cursor: pointer;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.25);
}

.note-text {
  margin: 0;
  font-size: 1.05rem;
}

.seeds-panel-hidden {
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.4s ease;
}

.final-stage {
  position: fixed;
  inset: 0;
  background: radial-gradient(circle at 50% 18%, rgba(74, 93, 35, 0.62), rgba(62, 39, 35, 0.78) 52%, rgba(8, 12, 9, 0.95));
  z-index: 1600;
  display: grid;
  place-items: center;
}

.final-canvas {
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
}

.lightbox-close {
  position: absolute;
  top: -14px;
  right: -14px;
  width: 38px;
  height: 38px;
  border-radius: 50%;
  border: none;
  background: #fbc02d;
  color: #3e2723;
  font-size: 1.4rem;
  cursor: pointer;
  box-shadow: 0 10px 24px rgba(0, 0, 0, 0.4);
}

.photo-base {
  position: relative;
  width: 100%;
  aspect-ratio: 4/5;
  border-radius: 20px;
  overflow: hidden;
  box-shadow: 0 20px 50px rgba(0, 0, 0, 0.4);
  border: 3px solid rgba(255, 255, 255, 0.1);
  transform: rotate(-2deg);
}

.photo-base img {
  width: 100%;
  height: 100%;
  object-fit: cover;
  filter: grayscale(100%) sepia(20%) brightness(0.9);
}

.photo-mask {
  position: absolute;
  inset: 0;
  background-image: var(--photo-url);
  background-size: cover;
  background-position: center;
  filter: none;
  clip-path: circle(0% at 50% 50%);
  transition: clip-path 0.15s linear;
  pointer-events: auto;
}

.memory-copy {
  background: rgba(255, 255, 255, 0.05);
  padding: 2.5rem;
  border-radius: 20px;
  border: 1px solid rgba(255, 255, 255, 0.1);
}

.countdown {
  display: flex;
  justify-content: space-between;
  margin: 2rem 0;
  padding: 2rem;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 15px;
}

.count-group {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.count-value {
  font-family: 'Playfair Display', serif;
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--leaf-accent);
}

.label {
  font-size: 0.75rem;
  text-transform: uppercase;
  opacity: 0.8;
  letter-spacing: 0.1em;
  margin-top: 0.5rem;
}

/* Pixel Art Section */
.pixel-stage {
  display: flex;
  gap: 3rem;
  align-items: center;
  justify-content: center;
  flex-wrap: wrap;
}

.pixel-grid {
  display: grid;
  grid-template-columns: repeat(10, 32px);
  gap: 5px;
  padding: 1.5rem;
  background: rgba(0, 0, 0, 0.4);
  border-radius: 12px;
}

.pixel-cell {
  width: 32px;
  height: 32px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
  display: grid;
  place-items: center;
  cursor: pointer;
  transition: all 0.2s;
}

.pixel-cell span {
  font-size: 1rem;
  font-weight: bold;
  color: var(--sun-yellow);
  opacity: 0;
  transform: scale(0.5);
  transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

.pixel-cell:hover {
  background: rgba(255, 255, 255, 0.25);
}

.pixel-cell:hover span {
  opacity: 1;
  transform: scale(1);
}

/* Carpir Panel */
.carpir-shell .panel-header {
  gap: 0.65rem;
}

.carpir-stage {
  display: grid;
  grid-template-columns: minmax(320px, 1fr) minmax(260px, 0.9fr);
  gap: clamp(1.4rem, 2.4vw, 2.6rem);
  align-items: start;
}

@media (max-width: 900px) {
  .carpir-stage {
    grid-template-columns: 1fr;
  }
}

.carpir-reveal {
  position: relative;
  width: min(540px, 92vw);
  aspect-ratio: 4 / 5;
  margin: 0 auto;
  border-radius: 18px;
  overflow: hidden;
  border: 4px solid rgba(110, 75, 44, 0.88);
  box-shadow: 0 20px 44px rgba(0, 0, 0, 0.45);
  background: #1d130d;
}

.carpir-reveal::before {
  content: '';
  position: absolute;
  inset: 6px;
  border: 1px solid rgba(255, 218, 168, 0.18);
  border-radius: 12px;
  pointer-events: none;
  z-index: 3;
}

#carpirPhoto {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  object-fit: cover;
  filter: saturate(1.08) contrast(1.08) brightness(1.05);
}

#carpirCanvas {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  touch-action: none;
  transition: opacity 0.85s ease;
  cursor: none;
}

#carpirCursor {
  position: absolute;
  top: 0;
  left: 0;
  width: 68px;
  height: auto;
  pointer-events: none;
  opacity: 0;
  z-index: 4;
  transform: translate(-18px, -50px) rotate(-18deg);
  transform-origin: 22px 44px;
  filter: drop-shadow(0 4px 6px rgba(0, 0, 0, 0.38));
  transition: opacity 0.16s ease;
  will-change: top, left;
}

.carpir-reveal.cursor-active #carpirCursor {
  opacity: 1;
}

@media (pointer: coarse) {
  #carpirCanvas {
    cursor: auto;
  }

  #carpirCursor {
    display: none;
  }
}

#carpirCanvas.cleared {
  opacity: 0;
}

.carpir-info {
  display: grid;
  gap: 1rem;
  align-content: start;
}

.carpir-message {
  margin: 0;
  padding: 1rem 1.1rem;
  border-radius: 12px;
  border: 1px solid rgba(255, 231, 183, 0.32);
  background: rgba(20, 12, 7, 0.58);
  color: #fdf2dc;
  font-family: 'Playfair Display', serif;
  line-height: 1.65;
  opacity: 0;
  transform: translateY(8px);
  transition: opacity 0.5s ease, transform 0.5s ease;
  text-shadow: 0 2px 8px rgba(0, 0, 0, 0.38);
}

.carpir-message.show {
  opacity: 1;
  transform: translateY(0);
}

/* Eco Mode */
.eco-mode-content {
  display: flex;
  gap: 3rem;
  align-items: center;
  flex-wrap: wrap;
}

body.eco-mode {
  filter: saturate(1.25);
}

.eco-toggle label {
  display: flex;
  align-items: center;
  gap: 1.5rem;
  cursor: pointer;
  padding: 1.2rem 2rem;
  background: rgba(0, 0, 0, 0.3);
  border-radius: 50px;
  border: 1px solid rgba(255, 255, 255, 0.15);
  transition: background 0.3s;
}

.eco-toggle label:hover {
  background: rgba(0, 0, 0, 0.4);
}

.eco-toggle input {
  display: none;
}

.toggle-track {
  width: 55px;
  height: 28px;
  background: rgba(255, 255, 255, 0.2);
  border-radius: 20px;
  position: relative;
  transition: background 0.3s;
}

.toggle-ball {
  position: absolute;
  left: 3px;
  top: 3px;
  width: 22px;
  height: 22px;
  background: white;
  border-radius: 50%;
  transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}

#ecoToggle:checked+label .toggle-track {
  background: var(--leaf-accent);
}

#ecoToggle:checked+label .toggle-ball {
  transform: translateX(27px);
}

.link-btn {
  margin-top: 1.5rem;
  padding: 0.9rem 2.5rem;
  background: linear-gradient(135deg, #2e5d32, #1a3c2a);
  color: white;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 50px;
  font-size: 1rem;
  font-family: 'Manrope', sans-serif;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s;
}

.link-btn:hover {
  background: linear-gradient(135deg, #3a7d42, #2e5d32);
  transform: translateY(-2px);
  box-shadow: 0 5px 20px rgba(121, 194, 103, 0.3);
}

.link-btn.secondary {
  background: rgba(255, 255, 255, 0.1);
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.link-btn.secondary:hover {
  background: rgba(255, 255, 255, 0.15);
}

.hidden {
  display: none;
}

/* Leaves Animation */
.eco-scatter {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  overflow: hidden;
}

.leaf {
  position: absolute;
  width: 20px;
  height: 20px;
  background: radial-gradient(circle at 30% 30%, #8fdc74 0%, #5c9a45 58%, #356329 100%);
  border-radius: 80% 0 80% 0;
  transform: rotate(45deg);
  opacity: 0;
  top: -50px;
  animation: fall 5s linear forwards;
}

@keyframes fall {
  0% {
    transform: translateY(-50px) rotate(0deg);
    opacity: 0;
  }

  10% {
    opacity: 0.8;
  }

  100% {
    transform: translateY(110vh) rotate(360deg);
    opacity: 0;
  }
}

/* Lluvia de Polen (reemplazada por luciérnagas) */
.pollen-container {
  position: absolute;
  inset: 0;
  pointer-events: none;
  overflow: hidden;
  z-index: 1;
}

.pollen {
  position: absolute;
  width: 8px;
  height: 8px;
  background: #ffee58;
  border-radius: 50%;
  box-shadow: 0 0 10px 4px rgba(255, 238, 88, 0.6);
  opacity: 0;
  transform: translate(-50%, -50%);
  animation: fireflyFade 4s ease-in-out infinite, fireflyDrift 6s ease-in-out infinite;
}

@keyframes fireflyFade {

  0%,
  100% {
    opacity: 0;
  }

  20% {
    opacity: 1;
  }

  60% {
    opacity: 0.3;
  }
}

@keyframes fireflyDrift {
  0% {
    transform: translate(-50%, -50%) translate(0, 0);
  }

  25% {
    transform: translate(-50%, -50%) translate(10px, -6px);
  }

  50% {
    transform: translate(-50%, -50%) translate(-8px, 8px);
  }

  75% {
    transform: translate(-50%, -50%) translate(12px, 4px);
  }

  100% {
    transform: translate(-50%, -50%) translate(0, 0);
  }
}

/* Responsive */
@media (max-width: 1024px) {
  .glass-panel {
    padding: 2.1rem;
  }

  .forest-panel,
  .seeds-stage,
  .seeds-field {
    min-height: 460px;
  }
}

@media (max-width: 768px) {
  .page {
    padding: 1rem 0.7rem;
    gap: 2rem;
  }

  .glass-panel {
    border-radius: 18px;
    padding: 1.25rem;
  }

  .hero {
    min-height: 74vh;
  }

  .hero-grid {
    padding: 0.2rem;
  }

  .petal-front.petal-active {
    width: clamp(74px, 20vw, 98px);
    height: clamp(132px, 34vw, 176px);
  }

  .petal-label {
    top: 5px;
    font-size: 0.79rem;
    padding: 0.14rem 0.42rem;
    background: rgba(0, 0, 0, 0.55);
    border-color: rgba(255, 241, 205, 0.44);
  }

  .panel-header p {
    font-size: 0.98rem;
    line-height: 1.55;
  }

  .forest-layout {
    gap: 1rem;
  }

  .forest-panel,
  .seeds-stage,
  .seeds-field {
    min-height: 390px;
    border-radius: 18px;
  }

  .daisy,
  .seed-daisy {
    width: 86px;
    height: 86px;
  }

  .carpir-reveal {
    width: min(94vw, 520px);
    border-radius: 14px;
  }

  #carpirCursor {
    width: 56px;
  }

  .link-btn {
    width: 100%;
    max-width: 340px;
    padding: 0.85rem 1.2rem;
    font-size: 0.95rem;
  }

  .note-card {
    max-width: min(92vw, 620px);
    padding: 1.2rem 1rem 1.3rem;
  }

  .note-close {
    top: 8px;
    right: 8px;
    width: 28px;
    height: 28px;
  }

  .note-text {
    font-size: 0.97rem;
    padding-right: 1.7rem;
  }

  .final-card {
    max-width: min(94vw, 680px);
    padding: 1.2rem;
  }

  .final-pre {
    letter-spacing: 0.2em;
    font-size: 0.73rem;
  }

  .final-card h3 {
    font-size: clamp(1.06rem, 5.6vw, 1.5rem);
    line-height: 1.45;
  }
}

@media (max-width: 420px) {
  #sunflower-container {
    width: min(600px, 96vw);
    height: min(600px, 96vw);
  }

  .sunflower-center {
    width: clamp(104px, 30vw, 140px);
    height: clamp(104px, 30vw, 140px);
  }

  .petal {
    width: clamp(58px, 16vw, 72px);
    height: clamp(102px, 26vw, 126px);
  }

  .petal-front.petal-active {
    width: clamp(68px, 19vw, 84px);
    height: clamp(124px, 33vw, 158px);
  }

  .petal-label {
    font-size: 0.73rem;
  }

  .forest-panel,
  .seeds-stage,
  .seeds-field {
    min-height: 340px;
  }

  .daisy,
  .seed-daisy {
    width: 76px;
    height: 76px;
  }
}

@media (pointer: coarse) {
  body::before,
  body::after {
    display: none;
  }

  body {
    background-attachment: scroll;
  }

  .glass-panel {
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
  }

  #sunflower-container.florecer .petal {
    animation: none;
  }

  .pollen {
    width: 6px;
    height: 6px;
    box-shadow: 0 0 8px 3px rgba(255, 238, 88, 0.45);
    animation: fireflyFade 6s ease-in-out infinite;
  }
}
